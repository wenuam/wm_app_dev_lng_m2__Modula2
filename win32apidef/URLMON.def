UNSAFEGUARDED DEFINITION MODULE URLMON;

(*
 * Replica of Microsoft urlmon.h
 *
 * Module is very incomplete, to be replenished.
 *)

FROM WIN32 IMPORT IID, CLSID, DWORD, LONG, ULONG, BOOL, LPWSTR, PVOID, HRESULT, SECURITY_ATTRIBUTES;

FROM OOle2 IMPORT LPOLESTR, FORMATETC, STGMEDIUM, IUnknown, IBindCtx, IMoniker;


CONST
	(* error which are returned in IBSC::OnStopBinding
	 *
	 *
	 * Note: FACILITY C is split into ranges of 1k
	 * C0000 - C03FF  INET_E_ (URLMON's original hresult)
	 * C0400 - C07FF  INET_E_CLIENT_xxx
	 * C0800 - C0BFF  INET_E_SERVER_xxx
	 * C0C00 - C0FFF  INET_E_????
	 * C1000 - C13FF  INET_E_AGENT_xxx (info delivery agents)
	 *)
	INET_E_INVALID_URL							= 0800C0002H;
	INET_E_NO_SESSION							= 0800C0003H;
	INET_E_CANNOT_CONNECT						= 0800C0004H;
	INET_E_RESOURCE_NOT_FOUND					= 0800C0005H;
	INET_E_OBJECT_NOT_FOUND						= 0800C0006H;
	INET_E_DATA_NOT_AVAILABLE					= 0800C0007H;
	INET_E_DOWNLOAD_FAILURE						= 0800C0008H;
	INET_E_AUTHENTICATION_REQUIRED				= 0800C0009H;
	INET_E_NO_VALID_MEDIA						= 0800C000AH;
	INET_E_CONNECTION_TIMEOUT					= 0800C000BH;
	INET_E_INVALID_REQUEST						= 0800C000CH;
	INET_E_UNKNOWN_PROTOCOL						= 0800C000DH;
	INET_E_SECURITY_PROBLEM						= 0800C000EH;
	INET_E_CANNOT_LOAD_DATA						= 0800C000FH;
	INET_E_CANNOT_INSTANTIATE_OBJECT			= 0800C0010H;
	INET_E_INVALID_CERTIFICATE					= 0800C0019H;
	INET_E_REDIRECT_FAILED						= 0800C0014H;
	INET_E_REDIRECT_TO_DIR						= 0800C0015H;
	INET_E_CANNOT_LOCK_REQUEST					= 0800C0016H;
	INET_E_USE_EXTEND_BINDING					= 0800C0017H;
	INET_E_TERMINATED_BIND						= 0800C0018H;
	INET_E_RESERVED_1							= 0800C001AH;
	INET_E_BLOCKED_REDIRECT_XSECURITYID			= 0800C001BH;
	INET_E_DOMINJECTIONVALIDATION				= 0800C001CH;
	INET_E_RESERVED_2							= 0800C001FH;
	INET_E_ERROR_FIRST							= 0800C0002H;
	INET_E_CODE_DOWNLOAD_DECLINED				= 0800C0100H;
	INET_E_RESULT_DISPATCHED					= 0800C0200H;
	INET_E_CANNOT_REPLACE_SFP_FILE				= 0800C0300H;
	INET_E_CODE_INSTALL_SUPPRESSED				= 0800C0400H;
	INET_E_CODE_INSTALL_BLOCKED_BY_HASH_POLICY	= 0800C0500H;
	INET_E_DOWNLOAD_BLOCKED_BY_INPRIVATE		= 0800C0501H;
	INET_E_CODE_INSTALL_BLOCKED_IMMERSIVE		= 0800C0502H;
	INET_E_FORBIDFRAMING						= 0800C0503H;
	INET_E_CODE_INSTALL_BLOCKED_ARM				= 0800C0504H;
	INET_E_BLOCKED_PLUGGABLE_PROTOCOL			= 0800C0505H;
	INET_E_BLOCKED_ENHANCEDPROTECTEDMODE		= 0800C0506H;
	INET_E_CODE_INSTALL_BLOCKED_BITNESS			= 0800C0507H;
	INET_E_ERROR_LAST							= INET_E_CODE_INSTALL_BLOCKED_BITNESS;

%IF DLL %THEN
<*/EXPORTALL/PROPAGATEEXCEPTIONALL/COPYATTRIBUTES*>
%END

<*/CALLS:WINDOWSCALL/DLLDEF/ENUMSIZE:BIG/Foreign*>
%IF AMD64 %THEN
<*/NOHIGH/NOPACK/ALIGN:8*>
%ELSE
<*/NOHIGH/PACK/ALIGN:4*>
%END

VAR
	%IF IA32 %THEN
		IID_IBinding					["_IID_IBinding"					EXTERNAL] : IID;
		IID_IBindStatusCallback			["_IID_IBindStatusCallback"			EXTERNAL] : IID;
		IID_IBindHost					["_IID_IBindHost"					EXTERNAL] : IID;
		SID_SBindHost					["_IID_IBindHost"					EXTERNAL] : IID;
	%ELSE
		IID_IBinding					["IID_IBinding"						EXTERNAL] : IID;
		IID_IBindStatusCallback			["IID_IBindStatusCallback"			EXTERNAL] : IID;
		IID_IBindHost					["IID_IBindHost"					EXTERNAL] : IID;
		SID_SBindHost					["IID_IBindHost"					EXTERNAL] : IID;
	%END


ABSTRACT CLASS IBinding;
INHERIT IUnknown;
REVEAL Abort, Suspend, Resume, SetPriority, GetPriority, GetBindResult;
    ABSTRACT PROCEDURE Abort () : HRESULT;
    ABSTRACT PROCEDURE Suspend () : HRESULT;
    ABSTRACT PROCEDURE Resume () : HRESULT;
    ABSTRACT PROCEDURE SetPriority (nPriority : LONG) : HRESULT;
    ABSTRACT PROCEDURE GetPriority (VAR pnPriority : LONG) : HRESULT;
    ABSTRACT PROCEDURE GetBindResult (VAR pclsidProtocol : CLSID; VAR pdwResult : DWORD; VAR pszResult : LPOLESTR;
		(*inout*) VAR pdwReserved : DWORD) : HRESULT;
END IBinding;

TYPE
	LPBINDING = IBinding;

	BINDVERB =
		(
			BINDVERB_GET		= 0,
			BINDVERB_POST		= 1,
			BINDVERB_PUT		= 2,
			BINDVERB_CUSTOM		= 3,
			BINDVERB_RESERVED1	= 4
		);
	BINDINFOF =
		(
			BINDINFOF_URLENCODESTGMEDDATA	= 1,
			BINDINFOF_URLENCODEDEXTRAINFO	= 2
		);
	BINDF =
		(
			BINDF_ASYNCHRONOUS				= 1H,
			BINDF_ASYNCSTORAGE				= 2H,
			BINDF_NOPROGRESSIVERENDERING	= 4H,
			BINDF_OFFLINEOPERATION			= 8H,
			BINDF_GETNEWESTVERSION			= 10H,
			BINDF_NOWRITECACHE				= 20H,
			BINDF_NEEDFILE					= 40H,
			BINDF_PULLDATA					= 80H,
			BINDF_IGNORESECURITYPROBLEM		= 100H,
			BINDF_RESYNCHRONIZE				= 200H,
			BINDF_HYPERLINK					= 400H,
			BINDF_NO_UI						= 800H,
			BINDF_SILENTOPERATION			= 1000H,
			BINDF_PRAGMA_NO_CACHE			= 2000H,
			BINDF_GETCLASSOBJECT			= 4000H,
			BINDF_RESERVED_1				= 8000H,
			BINDF_FREE_THREADED				= 10000H,
			BINDF_DIRECT_READ				= 20000H,
			BINDF_FORMS_SUBMIT				= 40000H,
			BINDF_GETFROMCACHE_IF_NET_FAIL	= 80000H,
			BINDF_FROMURLMON				= 100000H,
			BINDF_FWD_BACK					= 200000H,
			BINDF_PREFERDEFAULTHANDLER		= 400000H,
			BINDF_ENFORCERESTRICTED			= 800000H,
			BINDF_RESERVED_2				= 80000000H,
			BINDF_RESERVED_3				= 1000000H,
			BINDF_RESERVED_4				= 2000000H,
			BINDF_RESERVED_5				= 4000000H,
			BINDF_RESERVED_6				= 8000000H,
			BINDF_RESERVED_7				= 40000000H,
			BINDF_RESERVED_8				= 20000000H
		);
	URL_ENCODING =
		(
			URL_ENCODING_NONE			= 0,
			URL_ENCODING_ENABLE_UTF8	= 10000000H,
			URL_ENCODING_DISABLE_UTF8	= 20000000H
		);
	BINDINFO =
		RECORD
			cbSize : ULONG;
			szExtraInfo : LPWSTR;
			stgmedData : STGMEDIUM;
			grfBindInfoF : DWORD;
			dwBindVerb : DWORD;
			szCustomVerb : LPWSTR;
			cbstgmedData : DWORD;
			dwOptions : DWORD;
			dwOptionsFlags : DWORD;
			dwCodePage : DWORD;
			securityAttributes : SECURITY_ATTRIBUTES;
			iid : IID;
			pUnk : IUnknown;
			dwReserved : DWORD;
		END;
	REMSECURITY_ATTRIBUTES =
		RECORD
			nLength : DWORD;
			lpSecurityDescriptor : DWORD;
			bInheritHandle : BOOL;
		END;
	PREMSECURITY_ATTRIBUTES = POINTER TO REMSECURITY_ATTRIBUTES;
	LPREMSECURITY_ATTRIBUTES = POINTER TO REMSECURITY_ATTRIBUTES;
	RemBINDINFO =
		RECORD
			cbSize : ULONG;
			szExtraInfo : LPWSTR;
			grfBindInfoF : DWORD;
			dwBindVerb : DWORD;
			szCustomVerb : LPWSTR;
			cbstgmedData : DWORD;
			dwOptions : DWORD;
			dwOptionsFlags : DWORD;
			dwCodePage : DWORD;
			securityAttributes : REMSECURITY_ATTRIBUTES;
			iid : IID;
			pUnk : IUnknown;
			dwReserved : DWORD;
		END;
	RemFORMATETC =
		RECORD
			cfFormat : DWORD;
			ptd : DWORD;
			dwAspect : DWORD;
			lindex : LONG;
			tymed : DWORD;
		END;
	LPREMFORMATETC = POINTER TO RemFORMATETC;
	BINDINFO_OPTIONS =
		(
			BINDINFO_OPTIONS_WININETFLAG				= 10000H,
			BINDINFO_OPTIONS_ENABLE_UTF8				= 20000H,
			BINDINFO_OPTIONS_DISABLE_UTF8				= 40000H,
			BINDINFO_OPTIONS_USE_IE_ENCODING			= 80000H,
			BINDINFO_OPTIONS_BINDTOOBJECT				= 100000H,
			BINDINFO_OPTIONS_SECURITYOPTOUT				= 200000H,
			BINDINFO_OPTIONS_IGNOREMIMETEXTPLAIN		= 400000H,
			BINDINFO_OPTIONS_USEBINDSTRINGCREDS			= 800000H,
			BINDINFO_OPTIONS_IGNOREHTTPHTTPSREDIRECTS	= 1000000H,
			BINDINFO_OPTIONS_IGNORE_SSLERRORS_ONCE		= 2000000H,
			BINDINFO_WPC_DOWNLOADBLOCKED				= 8000000H,
			BINDINFO_WPC_LOGGING_ENABLED				= 10000000H,
			BINDINFO_OPTIONS_ALLOWCONNECTDATA			= 20000000H,
			BINDINFO_OPTIONS_DISABLEAUTOREDIRECTS		= 40000000H,
			BINDINFO_OPTIONS_SHDOCVW_NAVIGATE			= 80000000H
		);
	BSCF =
		(
			BSCF_FIRSTDATANOTIFICATION			= 1H,
			BSCF_INTERMEDIATEDATANOTIFICATION	= 2H,
			BSCF_LASTDATANOTIFICATION			= 4H,
			BSCF_DATAFULLYAVAILABLE				= 8H,
			BSCF_AVAILABLEDATASIZEUNKNOWN		= 10H,
			BSCF_SKIPDRAINDATAFORFILEURLS		= 20H,
			BSCF_64BITLENGTHDOWNLOAD			= 40H
		);
	BINDSTATUS =
		(
			BINDSTATUS_FINDINGRESOURCE	= 1,
			BINDSTATUS_CONNECTING,
			BINDSTATUS_REDIRECTING,
			BINDSTATUS_BEGINDOWNLOADDATA,
			BINDSTATUS_DOWNLOADINGDATA,
			BINDSTATUS_ENDDOWNLOADDATA,
			BINDSTATUS_BEGINDOWNLOADCOMPONENTS,
			BINDSTATUS_INSTALLINGCOMPONENTS,
			BINDSTATUS_ENDDOWNLOADCOMPONENTS,
			BINDSTATUS_USINGCACHEDCOPY,
			BINDSTATUS_SENDINGREQUEST,
			BINDSTATUS_CLASSIDAVAILABLE,
			BINDSTATUS_MIMETYPEAVAILABLE,
			BINDSTATUS_CACHEFILENAMEAVAILABLE,
			BINDSTATUS_BEGINSYNCOPERATION,
			BINDSTATUS_ENDSYNCOPERATION,
			BINDSTATUS_BEGINUPLOADDATA,
			BINDSTATUS_UPLOADINGDATA,
			BINDSTATUS_ENDUPLOADDATA,
			BINDSTATUS_PROTOCOLCLASSID,
			BINDSTATUS_ENCODING,
			BINDSTATUS_VERIFIEDMIMETYPEAVAILABLE,
			BINDSTATUS_CLASSINSTALLLOCATION,
			BINDSTATUS_DECODING,
			BINDSTATUS_LOADINGMIMEHANDLER,
			BINDSTATUS_CONTENTDISPOSITIONATTACH,
			BINDSTATUS_FILTERREPORTMIMETYPE,
			BINDSTATUS_CLSIDCANINSTANTIATE,
			BINDSTATUS_IUNKNOWNAVAILABLE,
			BINDSTATUS_DIRECTBIND,
			BINDSTATUS_RAWMIMETYPE,
			BINDSTATUS_PROXYDETECTING,
			BINDSTATUS_ACCEPTRANGES,
			BINDSTATUS_COOKIE_SENT,
			BINDSTATUS_COMPACT_POLICY_RECEIVED,
			BINDSTATUS_COOKIE_SUPPRESSED,
			BINDSTATUS_COOKIE_STATE_UNKNOWN,
			BINDSTATUS_COOKIE_STATE_ACCEPT,
			BINDSTATUS_COOKIE_STATE_REJECT,
			BINDSTATUS_COOKIE_STATE_PROMPT,
			BINDSTATUS_COOKIE_STATE_LEASH,
			BINDSTATUS_COOKIE_STATE_DOWNGRADE,
			BINDSTATUS_POLICY_HREF,
			BINDSTATUS_P3P_HEADER,
			BINDSTATUS_SESSION_COOKIE_RECEIVED,
			BINDSTATUS_PERSISTENT_COOKIE_RECEIVED,
			BINDSTATUS_SESSION_COOKIES_ALLOWED,
			BINDSTATUS_CACHECONTROL,
			BINDSTATUS_CONTENTDISPOSITIONFILENAME,
			BINDSTATUS_MIMETEXTPLAINMISMATCH,
			BINDSTATUS_PUBLISHERAVAILABLE,
			BINDSTATUS_DISPLAYNAMEAVAILABLE,
			BINDSTATUS_SSLUX_NAVBLOCKED,
			BINDSTATUS_SERVER_MIMETYPEAVAILABLE,
			BINDSTATUS_SNIFFED_CLASSIDAVAILABLE,
			BINDSTATUS_64BIT_PROGRESS,
			BINDSTATUS_LAST	= BINDSTATUS_64BIT_PROGRESS,
			BINDSTATUS_RESERVED_0,
			BINDSTATUS_RESERVED_1,
			BINDSTATUS_RESERVED_2,
			BINDSTATUS_RESERVED_3,
			BINDSTATUS_RESERVED_4,
			BINDSTATUS_RESERVED_5,
			BINDSTATUS_RESERVED_6,
			BINDSTATUS_RESERVED_7,
			BINDSTATUS_RESERVED_8,
			BINDSTATUS_RESERVED_9,
			BINDSTATUS_RESERVED_A,
			BINDSTATUS_RESERVED_B,
			BINDSTATUS_RESERVED_C,
			BINDSTATUS_RESERVED_D,
			BINDSTATUS_RESERVED_E,
			BINDSTATUS_LAST_PRIVATE	= BINDSTATUS_RESERVED_E
		);

ABSTRACT CLASS IBindStatusCallback;
INHERIT IUnknown;
REVEAL OnStartBinding, GetPriority, OnLowResource, OnProgress, OnStopBinding, GetBindInfo, OnDataAvailable, OnObjectAvailable;
    ABSTRACT PROCEDURE OnStartBinding (dwReserved : DWORD; pib : IBinding) : HRESULT;
    ABSTRACT PROCEDURE GetPriority (VAR pnPriority : LONG) : HRESULT;
    ABSTRACT PROCEDURE OnLowResource (reserved : DWORD) : HRESULT;
    ABSTRACT PROCEDURE OnProgress (ulProgress, ulProgressMax, ulStatusCode : LONG; szStatusText : ARRAY OF UCHAR) : HRESULT;
    ABSTRACT PROCEDURE OnStopBinding (hresult : HRESULT; szError : ARRAY OF UCHAR) : HRESULT;
    ABSTRACT PROCEDURE GetBindInfo (VAR grfBINDF : DWORD; (*inout*) VAR pbindinfo : BINDINFO) : HRESULT;
    ABSTRACT PROCEDURE OnDataAvailable (grfBSCF, dwSize : DWORD; pformatetc : FORMATETC; pstgmed : STGMEDIUM) : HRESULT;
    ABSTRACT PROCEDURE OnObjectAvailable (tiid : IID; punk : IUnknown) : HRESULT;
END IBindStatusCallback;

TYPE
	LPBINDSTATUSCALLBACK = IBindStatusCallback;

ABSTRACT CLASS IBindHost;
INHERIT IUnknown;
REVEAL CreateMoniker, MonikerBindToStorage, MonikerBindToObject;
    ABSTRACT PROCEDURE CreateMoniker (szName : ARRAY OF UCHAR; pBC : IBindCtx; VAR ppmk : IMoniker; dwReserved : DWORD) :
	HRESULT;
    ABSTRACT PROCEDURE MonikerBindToStorage (pMk : IMoniker; pBC : IBindCtx; pBSC : IBindStatusCallback; riid : IID;
		VAR ppvObj : PVOID) : HRESULT;
    ABSTRACT PROCEDURE MonikerBindToObject (pMk : IMoniker; pBC : IBindCtx; pBSC : IBindStatusCallback; riid : IID;
		VAR ppvObj : PVOID) : HRESULT;
END IBindHost;

TYPE
	LPBINDHOST = IBindHost;


PROCEDURE URLDownloadToFileA (pCaller : IUnknown; szURL, szFileName : ARRAY OF ACHAR; dwReserved : DWORD;
	lpfnCB : IBindStatusCallback) : HRESULT;

PROCEDURE URLDownloadToFileW (pCaller : IUnknown; szURL, szFileName : ARRAY OF UCHAR; dwReserved : DWORD;
	lpfnCB : IBindStatusCallback) : HRESULT;

PROCEDURE URLDownloadToCacheFileA (pCaller : IUnknown; szURL : ARRAY OF ACHAR; VAR szFileName : ARRAY OF ACHAR;
	cchFileName, dwReserved : DWORD; pBSC : IBindStatusCallback) : HRESULT;

PROCEDURE URLDownloadToCacheFileW (pCaller : IUnknown; szURL : ARRAY OF UCHAR; VAR szFileName : ARRAY OF UCHAR;
	cchFileName, dwReserved : DWORD; pBSC : IBindStatusCallback) : HRESULT;

%IF UNICODE %THEN

PROCEDURE URLDownloadToFile = URLDownloadToFileW;
PROCEDURE URLDownloadToCacheFile = URLDownloadToCacheFileW;

%ELSE

PROCEDURE URLDownloadToFile = URLDownloadToFileA;
PROCEDURE URLDownloadToCacheFile = URLDownloadToCacheFileA;

%END

END URLMON.
