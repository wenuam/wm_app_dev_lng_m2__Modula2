DEFINITION MODULE SimpleMAPI;
(* Simple MAPI API *)


%IF DLL %THEN
<*/EXPORTALL/PROPAGATEEXCEPTIONALL/COPYATTRIBUTES*>
%END

<*/CALLS:WINDOWSCALL/DLLDEF*>
%IF AMD64 %THEN
<*/NOHIGH/NOPACK/ALIGN:8*>
%ELSE
<*/NOHIGH/PACK/ALIGN:4*>
%END

FROM SYSTEM IMPORT
    ADDRESS;

FROM WIN32 IMPORT
    LPSTR, ULONG, HANDLE, LPVOID, ULONG_PTR;

TYPE
    FLAGS                       = CARDINAL32;
    LHANDLE                     = HANDLE;

CONST
    lhSessionNull               = 0;
    MAPI_MESSAGEID_LENGTH       = 64;

TYPE
    MapiFileDesc =
        RECORD
            ulReserved          : ULONG;
            flFlags             : ULONG;
            nPosition           : ULONG;
            lpszPathName        : LPSTR;
            lpszFileName        : LPSTR;
            lpFileType          : ADDRESS;
        END;
    lpMapiFileDesc      = POINTER TO MapiFileDesc;


CONST
    MAPI_OLE            = 1;
    MAPI_OLE_STATIC     = 2;

TYPE
    MapiRecipDesc =
        RECORD
        ulReserved      : ULONG;
        ulRecipClass    : ULONG;        (* MAPI_TO, MAPI_CC, MAPI_BCC, MAPI_ORIG *)
        lpszName        : LPSTR;        (* Empfänger-Name *)
        lpszAddress     : LPSTR;        (* Empfänger-Adresse (optional) *)
        ulEIDSize       : ULONG;        (* Länge in Bytes von pEntryID *)
        lpEntryID       : ADDRESS;
        END;
        lpMapiRecipDesc = POINTER TO MapiRecipDesc;

        lpMapiRecipDescArray    = POINTER TO ARRAY [0..0] OF MapiRecipDesc;

CONST
    MAPI_ORIG   = 0;    (* Recipient is message originator *)
    MAPI_TO     = 1;    (* Recipient is a primary recipient *)
    MAPI_CC     = 2;    (* Recipient is a copy recipient *)
    MAPI_BCC    = 3;    (* Recipient is blind copy recipient *)

TYPE
    MapiMessage =
        RECORD
            ulReserved          : ULONG;
            lpszSubject         : LPSTR;                (* Message Subject *)
            lpszNoteText        : LPSTR;                (* Message Text *)
            lpszMessageType     : LPSTR;                (* Message Class *)
            lpszDateReceived    : LPSTR;                (* in YYYY/MM/DD HH:MM format *)
            lpszConversationID  : LPSTR;                (* conversation thread ID *)
            flFlags             : FLAGS;                (* unread,return receipt *)
            lpOriginator        : lpMapiRecipDesc;      (* Originator descriptor *)
            nRecipCount         : ULONG;                (* Number of recipients *)
            lpRecips            : lpMapiRecipDesc;      (* Recipient descriptors *)
            nFileCount          : ULONG;                (* # of file attachments *)
            lpFiles             : lpMapiFileDesc;       (* Attachment descriptors *)
        END;
    lpMapiMessage =     POINTER TO MapiMessage;

CONST
    MAPI_UNREAD                 = 1;
    MAPI_RECEIPT_REQUESTED      = 2;
    MAPI_SENT                   = 4;

(* Entry Points : *)
    MAPI_LOGON_UI               = 00000001H;    (* Display logon UI *)
    MAPI_NEW_SESSION            = 00000002H;    (* Do not use default. *)
    MAPI_DIALOG                 = 00000008H;    (* Display a send note UI *)
    MAPI_UNREAD_ONLY            = 00000020H;    (* Only unread messages *)
    MAPI_ENVELOPE_ONLY          = 00000040H;    (* Only header information *)
    MAPI_PEEK                   = 00000080H;    (* Do not mark as read. *)
    MAPI_GUARANTEE_FIFO         = 00000100H;    (* use date order *)
    MAPI_BODY_AS_FILE           = 00000200H;    (* *)
    MAPI_AB_NOMODIFY            = 00000400H;    (* Don't allow mods of AB entries *)
    MAPI_SUPPRESS_ATTACH        = 00000800H;    (* header + body, no files *)
    MAPI_FORCE_DOWNLOAD         = 00001000H;    (* force download of new mail during MAPILogon *)


PROCEDURE MAPIinit() : BOOLEAN;
(* has to be called before the first using of this module to load the MAPI - DLL *)
(* returns FALSE, if the DLL is not loadable *)

PROCEDURE MAPILogon(ulUIParam : ULONG_PTR;
                    lpszName, lpszPassword : ARRAY OF CHAR;
                    flFlags : FLAGS;
                    ulReserved : ULONG;
                    VAR OUT lhSession : LHANDLE) : ULONG;

PROCEDURE MAPILogoff(lhSession : LHANDLE;
                     ulUIParam : ULONG_PTR;
                     flFlags : FLAGS;
                     ulReserved : ULONG) : ULONG;

PROCEDURE MAPISendMail(lhSession : LHANDLE;
                       ulUIParam : ULONG_PTR;
                       lpMessage : MapiMessage;
                       flFlags : FLAGS;
                       ulReserved : ULONG) : ULONG;

PROCEDURE MAPISendDocuments(ulUIParam : ULONG_PTR;
                            lpszDelimChar, lpszFilePaths, lpszFileNames  : ARRAY OF CHAR;
                            ulReserved : ULONG) : ULONG;

PROCEDURE MAPIFindNext(lhSession : LHANDLE;
                       ulUIParam : ULONG_PTR;
                       lpszMessageType, lpszSeedMessageID : ARRAY OF CHAR;
                       flFlags : FLAGS;
                       ulReserved : ULONG;
                       lpszMessageID : ARRAY OF CHAR) : ULONG;

PROCEDURE MAPIReadMail(lhSession : LHANDLE;
                       ulUIParam : ULONG_PTR;
                       lpszMessageID : ARRAY OF CHAR;
                       flFlags : FLAGS;
                       ulReserved : ULONG;
                       VAR OUT lppMessageOut : lpMapiMessage) : ULONG;

PROCEDURE MAPISaveMail(lhSession : LHANDLE;
                       ulUIParam : ULONG_PTR;
                       lpMessage : MapiMessage;
                       flFlags : FLAGS;
                       ulReserved : ULONG;
                       lpszMessageID : ARRAY OF CHAR) : ULONG;

PROCEDURE MAPIDeleteMail(lhSession : LHANDLE;
                         ulUIParam : ULONG_PTR;
                         lpszMessageID : ARRAY OF CHAR;
                         flFlags : FLAGS;
                         ulReserved : ULONG) : ULONG;

PROCEDURE MAPIFreeBuffer(pv : LPVOID) : ULONG;

PROCEDURE MAPIAddress(lhSession : LHANDLE;
                      ulUIParam : ULONG_PTR;
                      lpszCaption : ARRAY OF CHAR;
                      nEditFields : ULONG;
                      lpszLabels : ARRAY OF CHAR;
                      nRecips : ULONG;
                      lpRecips : ARRAY OF MapiRecipDesc;
                      flFlags : FLAGS;
                      ulReserved : ULONG;
                      VAR OUT lpnNewRecips : ULONG;
                      VAR OUT lppNewRecips : lpMapiRecipDescArray) : ULONG;

PROCEDURE MAPIDetails(lhSession : LHANDLE;
                      ulUIParam : ULONG_PTR;
                      lpRecips : MapiRecipDesc;
                      flFlags : FLAGS;
                      ulReserved : ULONG) : ULONG;

PROCEDURE MAPIResolveName(lhSession : LHANDLE;
                          ulUIParam : ULONG_PTR;
                          lpszName : ARRAY OF CHAR;
                          flFlags : FLAGS;
                          ulReserved : ULONG;
                          VAR OUT lppRecip : lpMapiRecipDesc) : ULONG;

CONST
    SUCCESS_SUCCESS                     = 0;
    MAPI_USER_ABORT                     = 1;
    MAPI_E_FAILURE                      = 2;
    MAPI_E_LOGIN_FAILURE                = 3;
    MAPI_E_DISK_FULL                    = 4;
    MAPI_E_INSUFFICIENT_MEMORY          = 5;
    MAPI_E_ACCESS_DENIED                = 6;
    MAPI_E_TOO_MANY_SESSIONS            = 8;
    MAPI_E_TOO_MANY_FILES               = 9;
    MAPI_E_TOO_MANY_RECIPIENTS          = 10;
    MAPI_E_ATTACHMENT_NOT_FOUND         = 11;
    MAPI_E_ATTACHMENT_OPEN_FAILURE      = 12;
    MAPI_E_ATTACHMENT_WRITE_FAILURE     = 13;
    MAPI_E_UNKNOWN_RECIPIENT            = 14;
    MAPI_E_BAD_RECIPTYPE                = 15;
    MAPI_E_NO_MESSAGES                  = 16;
    MAPI_E_INVALID_MESSAGE              = 17;
    MAPI_E_TEXT_TOO_LARGE               = 18;
    MAPI_E_INVALID_SESSION              = 19;
    MAPI_E_TYPE_NOT_SUPPORTED           = 20;
    MAPI_E_AMBIGUOUS_RECIPIENT          = 21;
    MAPI_E_MESSAGE_IN_USE               = 22;
    MAPI_E_NETWORK_FAILURE              = 23;
    MAPI_E_INVALID_EDITFIELDS           = 24;
    MAPI_E_INVALID_RECIPS               = 25;
    MAPI_E_NOT_SUPPORTED                = 26;

END SimpleMAPI.
